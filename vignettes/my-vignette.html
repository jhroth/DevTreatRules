<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Using DevTreatRules</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Using DevTreatRules</h1>



<p>Here, we illustrate the <code>DevTreatRules</code> package by building and evaluating treatment rules based on the example dataset included with the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(example_df)
##   no_relapse intervention prognosis clinic age    gene_1     gene_2
## 1          1            0      Good      1  46 0.5310173 0.07099905
## 2          0            1      Poor      3  51 0.7442478 0.71140730
## 3          1            0      Poor      3  62 1.1457067 0.49774589
## 4          1            0      Good      5  51 1.8164156 1.75836075
## 5          1            1      Good      4  52 0.4033639 0.63595776
## 6          1            1      Poor      6  51 1.7967794 0.64224101
##       gene_3    gene_4    gene_5    gene_6    gene_7     gene_8    gene_9
## 1 0.12942499 0.4267279 0.4212055 0.4020566 0.8306180 0.01360592 1.1860618
## 2 1.35322480 1.9387141 0.2295728 0.2278341 0.2819428 1.34130370 1.1057664
## 3 1.47074339 1.4555414 0.2907281 0.5434910 0.9150085 0.48388632 1.1934081
## 4 0.22259933 0.6879271 0.6198644 1.5705087 1.6060260 1.99863441 0.7852614
## 5 0.09330924 0.2880235 0.3004841 1.2759616 0.6422256 1.90029195 0.5207518
## 6 0.26182062 0.2771150 1.0533635 0.9391015 1.7362673 0.23480846 1.4797667
##      gene_10
## 1 1.88311575
## 2 0.66055448
## 3 0.62333391
## 4 1.76844683
## 5 0.01259864
## 6 1.39081329</code></pre></div>
<div id="split-the-dataset" class="section level2">
<h2>Split the Dataset</h2>
<p>First, we split <code>example_df</code> into independent development/validation/evaluation partitions by calling the <code>SplitData()</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
example.split &lt;-<span class="st"> </span><span class="kw">SplitData</span>(<span class="dt">data=</span>example_df, <span class="dt">n.sets=</span><span class="dv">3</span>, <span class="dt">split.proportions=</span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>))
<span class="kw">table</span>(example.split<span class="op">$</span>partition)
## 
## development  validation  evaluation 
##        2500        1250        1250</code></pre></div>
<p>and then forming independent datasets based on the <code>partition</code> variable created above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
development.data &lt;-<span class="st"> </span>example.split <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(partition <span class="op">==</span><span class="st"> &quot;development&quot;</span>)
validation.data &lt;-<span class="st">  </span>example.split <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(partition <span class="op">==</span><span class="st"> &quot;validation&quot;</span>)
evaluation.data &lt;-<span class="st">  </span>example.split <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(partition <span class="op">==</span><span class="st"> &quot;evaluation&quot;</span>)</code></pre></div>
</div>
<div id="specify-variable-roles" class="section level2">
<h2>Specify Variable Roles</h2>
<p>Suppose we believe the variables <code>prognosis</code>, <code>clinic</code>, and <code>age</code> may have influenced treatment assignment. We would codify this knowledge into <code>DevTreatRules</code> by specifying the argument</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">names.influencing.treatment=<span class="kw">c</span>(<span class="st">&quot;prognosis&quot;</span>, <span class="st">&quot;clinic&quot;</span>, <span class="st">&quot;age&quot;</span>)</code></pre></div>
<p>in functions we will call later in this vignette. Further suppose that we don’t expect <code>prognosis</code> and <code>clinic</code> to be measured on the same scale in independent clinical settings where we would like to apply our estimated rule (so they are not sensible rule inputs). However, we do expect the gene expression measurements in <code>gene_1</code>, …, <code>gene_10</code> to potentially influence treatment response and also to be reliably measured in future settings (so they are sensible rule inputs). We specify this knowledge in <code>DevTreatRules</code> with the argument</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">names.influencing.rule=<span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;gene_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</code></pre></div>
</div>
<div id="on-the-development-dataset-build-the-treatment-rule" class="section level2">
<h2>On the Development Dataset, Build the Treatment Rule</h2>
<p>Although we could directly estimate a single treatment rule on the development dataset with <code>BuildRule()</code> using, for example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">one.rule &lt;-<span class="st"> </span><span class="kw">BuildRule</span>(<span class="dt">data=</span>development.data,
                      <span class="dt">study.design=</span><span class="st">&quot;observational&quot;</span>,
                      <span class="dt">prediction.approach=</span><span class="st">&quot;split.regression&quot;</span>,
                      <span class="dt">name.outcome=</span><span class="st">&quot;no_relapse&quot;</span>,
                      <span class="dt">type.outcome=</span><span class="st">&quot;binary&quot;</span>,
                      <span class="dt">desirable.outcome=</span><span class="ot">TRUE</span>,
                      <span class="dt">name.treatment=</span><span class="st">&quot;intervention&quot;</span>,
                      <span class="dt">names.influencing.treatment=</span><span class="kw">c</span>(<span class="st">&quot;prognosis&quot;</span>, <span class="st">&quot;clinic&quot;</span>, <span class="st">&quot;age&quot;</span>),
                      <span class="dt">names.influencing.rule=</span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;gene_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)),
                      <span class="dt">propensity.method=</span><span class="st">&quot;logistic.regression&quot;</span>,
                      <span class="dt">rule.method=</span><span class="st">&quot;glm.regression&quot;</span>)</code></pre></div>
<p>this has limited utility because it required us to specify just one value for the <code>prediction.approach</code> argument (even if we don’t have <em>a priori</em> knowledge about which of split-regression, OWL framework, and direct-interactions approaches will perform best) and to specify just one regression method for the <code>propensity.score</code> and <code>rule.method</code> arguments (even if we are not sure whether standard GLM or lasso/ridge GLM will yield a better rule).</p>
<p>In view of this, it would be more useful to perform model selection to estimate rules for different combinations of split-regression/OWL framework/direct-interactions and standard/lasso/ridge logistic regression (e.g. by looping over calls to <code>BuildRule()</code>). The model-selection process is automated in <code>CompareRulesOnValidation()</code>.</p>
</div>
<div id="on-the-validation-dataset-perform-model-selection" class="section level2">
<h2>On the Validation Dataset, Perform Model Selection</h2>
<p>Here we will perform model selection by calling <code>CompareRulesOnValidation()</code> with the arguments</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec.approaches=<span class="kw">c</span>(<span class="st">&quot;split.regression&quot;</span>, <span class="st">&quot;OWL.framework&quot;</span>, <span class="st">&quot;direct.interactions&quot;</span>)
vec.rule.methods=<span class="kw">c</span>(<span class="st">&quot;glm.regression&quot;</span>, <span class="st">&quot;lasso&quot;</span>, <span class="st">&quot;ridge&quot;</span>)</code></pre></div>
<p>which are actually the default values of <code>CompareRulesOnValidation()</code>, and</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec.propensity.methods=<span class="st">&quot;logistic.regression&quot;</span></code></pre></div>
<p>Now we perform model selection by calling <code>CompareRuleonValdation()</code> with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
model.selection &lt;-<span class="st"> </span><span class="kw">CompareRulesOnValidation</span>(<span class="dt">development.data=</span>development.data,
                <span class="dt">validation.data=</span>validation.data,
                <span class="dt">study.design.development=</span><span class="st">&quot;observational&quot;</span>,
                <span class="dt">vec.approaches=</span><span class="kw">c</span>(<span class="st">&quot;split.regression&quot;</span>, <span class="st">&quot;OWL.framework&quot;</span>, <span class="st">&quot;direct.interactions&quot;</span>),
                <span class="dt">vec.rule.methods=</span><span class="kw">c</span>(<span class="st">&quot;glm.regression&quot;</span>, <span class="st">&quot;lasso&quot;</span>, <span class="st">&quot;ridge&quot;</span>),
                <span class="dt">vec.propensity.methods=</span><span class="st">&quot;logistic.regression&quot;</span>,
                <span class="dt">name.outcome.development=</span><span class="st">&quot;no_relapse&quot;</span>,
                <span class="dt">type.outcome.development=</span><span class="st">&quot;binary&quot;</span>,
                <span class="dt">name.treatment.development=</span><span class="st">&quot;intervention&quot;</span>,
                <span class="dt">names.influencing.treatment.development=</span><span class="kw">c</span>(<span class="st">&quot;prognosis&quot;</span>, <span class="st">&quot;clinic&quot;</span>, <span class="st">&quot;age&quot;</span>),
                <span class="dt">names.influencing.rule.development=</span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;gene_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)),
                <span class="dt">desirable.outcome.development=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>The object returned by <code>CompareRulesOnValidation</code> contains the following estimates computed on the validation set: number of individuals recommended to receive treatment (<code>Positives</code>), number of individuals recommended to not receive treatment (<code>Negatives</code>), the average treatment effect in each subset (<code>ATE in Positives</code> and <code>ATE in Negatives</code>), and average benefit of using the rule (<code>ABR</code>).</p>
<p>We can compare these estimates for the nine treatment rules (three model specifications for each of the three approaches) to decide which rules to bring forward to the evaluation dataset.</p>
<p>First, for rules estimated with the split-regression approach, we obtain the estimates </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model.selection<span class="op">$</span>list.summaries[[<span class="st">&quot;split.regression&quot;</span>]] 
##                                                    Positives Negatives
## propensity_logistic.regression_rule_glm.regression       787       463
## propensity_logistic.regression_rule_lasso               1089       161
## propensity_logistic.regression_rule_ridge               1250         0
##                                                    ATE in Positives
## propensity_logistic.regression_rule_glm.regression       0.11122870
## propensity_logistic.regression_rule_lasso                0.06001908
## propensity_logistic.regression_rule_ridge                0.03832939
##                                                    ATE in Negatives
## propensity_logistic.regression_rule_glm.regression       -0.1053204
## propensity_logistic.regression_rule_lasso                -0.2576037
## propensity_logistic.regression_rule_ridge                        NA
##                                                           ABR
## propensity_logistic.regression_rule_glm.regression 0.10904028
## propensity_logistic.regression_rule_lasso          0.08546798
## propensity_logistic.regression_rule_ridge          0.03832939</code></pre></div>
<p>Next, for the OWL framework we have </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model.selection<span class="op">$</span>list.summaries[[<span class="st">&quot;OWL.framework&quot;</span>]] 
##                                                    Positives Negatives
## propensity_logistic.regression_rule_glm.regression       742       508
## propensity_logistic.regression_rule_lasso               1250         0
## propensity_logistic.regression_rule_ridge               1250         0
##                                                    ATE in Positives
## propensity_logistic.regression_rule_glm.regression       0.10305639
## propensity_logistic.regression_rule_lasso                0.03832939
## propensity_logistic.regression_rule_ridge                0.03832939
##                                                    ATE in Negatives
## propensity_logistic.regression_rule_glm.regression      -0.07065708
## propensity_logistic.regression_rule_lasso                        NA
## propensity_logistic.regression_rule_ridge                        NA
##                                                           ABR
## propensity_logistic.regression_rule_glm.regression 0.08988931
## propensity_logistic.regression_rule_lasso          0.03832939
## propensity_logistic.regression_rule_ridge          0.03832939</code></pre></div>
<p>and, last, for the direct-interactions approach </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model.selection<span class="op">$</span>list.summaries[[<span class="st">&quot;direct.interactions&quot;</span>]] 
##                                                    Positives Negatives
## propensity_logistic.regression_rule_glm.regression      1124       126
## propensity_logistic.regression_rule_lasso               1250         0
## propensity_logistic.regression_rule_ridge               1243         7
##                                                    ATE in Positives
## propensity_logistic.regression_rule_glm.regression       0.06211271
## propensity_logistic.regression_rule_lasso                0.03832939
## propensity_logistic.regression_rule_ridge                0.03856171
##                                                    ATE in Negatives
## propensity_logistic.regression_rule_glm.regression     -0.247318091
## propensity_logistic.regression_rule_lasso                        NA
## propensity_logistic.regression_rule_ridge              -0.002925383
##                                                           ABR
## propensity_logistic.regression_rule_glm.regression 0.08078141
## propensity_logistic.regression_rule_lasso          0.03832939
## propensity_logistic.regression_rule_ridge          0.03836215</code></pre></div>
<p>Based on the above estimates in the validation set, we decide to select two rules to bring forward to the evaluation set: split-regression with logistic/logistic as the propensity/rule methods and OWL framework with logistic/logistic as the propensity/rule methods.</p>
<p>We can also see the underlying coefficient estimates for these rules with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule.split &lt;-<span class="st"> </span>model.selection<span class="op">$</span>list.rules<span class="op">$</span>split.regression[[<span class="st">&quot;propensity_logistic.regression_rule_glm.regression&quot;</span>]]
<span class="kw">coef</span>(rule.split<span class="op">$</span>rule.object.control)
##  (Intercept)          age       gene_1       gene_2       gene_3 
##  0.388518744  0.012299543 -0.412122635  0.047482501 -0.097929857 
##       gene_4       gene_5       gene_6       gene_7       gene_8 
## -0.128450083 -0.044386377 -0.135912557 -0.246068247  0.097460512 
##       gene_9      gene_10 
## -0.004977984  0.050264338
<span class="kw">coef</span>(rule.split<span class="op">$</span>rule.object.treat)
##  (Intercept)          age       gene_1       gene_2       gene_3 
## -0.204358106 -0.002120024  0.295883086 -0.079181506 -0.036792693 
##       gene_4       gene_5       gene_6       gene_7       gene_8 
##  0.014692151  0.308744926 -0.001624233  0.028541657 -0.046254953 
##       gene_9      gene_10 
##  0.083317777  0.088698809</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule.OWL &lt;-<span class="st"> </span>model.selection<span class="op">$</span>list.rules<span class="op">$</span>OWL.framework[[<span class="st">&quot;propensity_logistic.regression_rule_glm.regression&quot;</span>]]
<span class="kw">coef</span>(rule.OWL<span class="op">$</span>rule.object)
##  (Intercept)          age       gene_1       gene_2       gene_3 
## -0.164793593 -0.007442362  0.282574653 -0.120767014 -0.145166107 
##       gene_4       gene_5       gene_6       gene_7       gene_8 
##  0.069026841  0.180280257  0.098949349  0.058407463  0.141297073 
##       gene_9      gene_10 
##  0.192256160 -0.128279062</code></pre></div>
</div>
<div id="on-the-evaluation-dataset-evaluate-the-selected-treatment-rules" class="section level2">
<h2>On the Evaluation Dataset, Evaluate the Selected Treatment Rules</h2>
<p>Since the validation dataset informed our model selection (i.e. we selected these particular two rules because they appeared best on the validation set), the estimates from the validation set itself are not trustworthy estimates of performance in independent settings. To obtain a trustworthy estimate of the rules’ performance in independent samples drawn from the same population, we turn to the <code>EvaluateRule()</code> function applied to the <strong>evaluation</strong> dataset.</p>
<p>First we obtain the estimated performance of the rule using split-regression with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
split.eval &lt;-<span class="st"> </span><span class="kw">EvaluateRule</span>(<span class="dt">data=</span>evaluation.data,
                           <span class="dt">BuildRule.object=</span>rule.split,
                           <span class="dt">study.design=</span><span class="st">&quot;observational&quot;</span>,
                           <span class="dt">name.outcome=</span><span class="st">&quot;no_relapse&quot;</span>,
                           <span class="dt">type.outcome=</span><span class="st">&quot;binary&quot;</span>,
                           <span class="dt">desirable.outcome=</span><span class="ot">TRUE</span>,
                           <span class="dt">name.treatment=</span><span class="st">&quot;intervention&quot;</span>,
                           <span class="dt">names.influencing.treatment=</span><span class="kw">c</span>(<span class="st">&quot;prognosis&quot;</span>, <span class="st">&quot;clinic&quot;</span>, <span class="st">&quot;age&quot;</span>),
                           <span class="dt">names.influencing.rule=</span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;gene_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)),
                           <span class="dt">bootstrap.CI=</span><span class="ot">FALSE</span>)
split.eval[<span class="kw">c</span>(<span class="st">&quot;n.test.positives&quot;</span>, <span class="st">&quot;n.test.negatives&quot;</span>, <span class="st">&quot;ATE.test.positives&quot;</span>, <span class="st">&quot;ATE.test.negatives&quot;</span>, <span class="st">&quot;ABR&quot;</span>)]
## $n.test.positives
## [1] 772
## 
## $n.test.negatives
## [1] 478
## 
## $ATE.test.positives
## [1] 0.05569962
## 
## $ATE.test.negatives
## [1] -0.1800403
## 
## $ABR
## [1] 0.1032475</code></pre></div>
<p>Next, the rule from OWL framework yields the following estimates</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
OWL.framework.eval &lt;-<span class="st"> </span><span class="kw">EvaluateRule</span>(<span class="dt">data=</span>evaluation.data,
                              <span class="dt">BuildRule.object=</span>rule.OWL,
                              <span class="dt">study.design=</span><span class="st">&quot;observational&quot;</span>,
                              <span class="dt">name.outcome=</span><span class="st">&quot;no_relapse&quot;</span>,
                              <span class="dt">type.outcome=</span><span class="st">&quot;binary&quot;</span>,
                              <span class="dt">desirable.outcome=</span><span class="ot">TRUE</span>,
                              <span class="dt">name.treatment=</span><span class="st">&quot;intervention&quot;</span>,
                              <span class="dt">names.influencing.treatment=</span><span class="kw">c</span>(<span class="st">&quot;prognosis&quot;</span>, <span class="st">&quot;clinic&quot;</span>, <span class="st">&quot;age&quot;</span>),
                              <span class="dt">names.influencing.rule=</span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;gene_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)),
                              <span class="dt">bootstrap.CI=</span><span class="ot">FALSE</span>)
OWL.framework.eval[<span class="kw">c</span>(<span class="st">&quot;n.test.positives&quot;</span>, <span class="st">&quot;n.test.negatives&quot;</span>, <span class="st">&quot;ATE.test.positives&quot;</span>, <span class="st">&quot;ATE.test.negatives&quot;</span>, <span class="st">&quot;ABR&quot;</span>)]
## $n.test.positives
## [1] 744
## 
## $n.test.negatives
## [1] 506
## 
## $ATE.test.positives
## [1] 0.03918277
## 
## $ATE.test.negatives
## [1] -0.1192884
## 
## $ABR
## [1] 0.07160952</code></pre></div>
<p>We could have also obtain bootstrap-based CIs for the ATE/ABR estimates (in both the validation and evaluation datasets) by specifying the arguments to <code>BuildRulesOnValidation</code> and <code>EvaluateRule()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bootstrap.CI=<span class="ot">TRUE</span>
booststrap.CI.replications=<span class="dv">1000</span></code></pre></div>
<p>(or for any desired number of replications) but we chose not to compute CIs in this example to minimize run-time.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
